{"version":3,"file":"assignsubmission_declaration.min.js","sources":["../src/assignsubmission_declaration.js"],"sourcesContent":["import ModalAddDeclaration from 'assignsubmission_declaration/modal_add_new_declaration';\nimport ModalFactory from 'core/modal_factory';\n\nconst addDeclarationHandler = function (e) {\n    console.log(e);\n    var trigger = $('#add-new-declaration-btn');\n    ModalFactory.create({\n        type: ModalAddDeclaration.TYPE\n    }, trigger);\n\n}\n\nconst selectSubmissionHandler = function (e) {\n    if (e.target.checked) {\n        // Show elements related to declaration submission\n        showSubmissionDeclarationElements();\n    } else {\n        // Hide elements related to declaration submission\n        hideSubmissionDeclarationElements();\n\n    }\n}\n\nconst hideSubmissionDeclarationElements = function () {\n    let match = Array.from(document.querySelectorAll('[id^=id_assignsubmission_declaration_]'));\n    document.getElementById('add-new-declaration-btn').style.display = 'none';\n    match.forEach(el => {\n        if (el.getAttribute('id') != 'id_assignsubmission_declaration_enabled') {\n            el.style.display = 'none';\n        }\n    });\n}\n\nconst showSubmissionDeclarationElements = function () {\n    document.getElementById('add-new-declaration-btn').style.display = 'inline-block';\n    let match = Array.from(document.querySelectorAll('[id^=id_assignsubmission_declaration_]'));\n    match.forEach(el => {\n        if (el.getAttribute('id') != 'id_assignsubmission_declaration_enabled') {\n            el.style.display = '';\n        }\n    });\n}\n\nconst changeTextareaHandler = (e) => {\n    console.log(\"changeTextareaHandler\");\n    // Empty textarea\n    if (document.getElementById(e.target.id).value == '') {\n        document.getElementById(e.target.id).classList.add('empty-value-error');\n        document.getElementById(e.target.id).value = \"Declaration description cannot be empty\";\n    } else {\n        document.getElementById(e.target.id).classList.remove('empty-value-error');\n    }\n    let id = (e.target.id).split('_');\n    id = id[id.length - 1];\n    const data = JSON.parse(document.getElementById('id_declarationjson').value);\n    const updateData = {\n        id: id,\n        declaration_text: document.getElementById(e.target.id).value\n    };\n\n    console.log(updateData);\n    data.forEach((d) => {\n        console.log(d);\n        if (d.id == updateData.id && updateData.declaration_text != \"Declaration description cannot be empty\") {\n            d.declaration_text = updateData.declaration_text;\n        }\n    }, updateData);\n\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\n\n}\n\nconst makeTitleEditable = () => {\n\n    Array.from(document.querySelectorAll('#fgroup_id_assignsubmission_declaration_group')).forEach((child, index) => {\n        Array.from(child.children).forEach((child1, index) => {\n          //  console.log(child1);\n            Array.from(child1.children).forEach((child, index) => {\n                if (index == 0 && child.nodeName == 'P') {\n                    child.setAttribute('contenteditable', true);\n                    child.addEventListener('input', changeTitleHandler);\n                };\n            }, child1);\n        });\n\n    });\n\n}\n\nconst changeTitleHandler = (e) => {\n    //title div -> textarea div\n    console.log(e.target.id);\n    if (document.getElementById(e.target.id).innerHTML == '') {\n        document.getElementById(e.target.id).innerHTML = \"Title cannot be empty\";\n        document.getElementById(e.target.id).style.border = \"2px solid red\";\n    } else {\n        document.getElementById(e.target.id).style.border = \"\";\n    }\n\n    let id = e.target.id.split('_'); // Get the element that has the textarea nested and that it has the id we need.\n    id = id[id.length - 1];\n    console.log(e.target.id);\n    const data = JSON.parse(document.getElementById('id_declarationjson').value);\n    const updateData = {\n        id: id,\n        declaration_title: document.getElementById(e.target.id).innerHTML.replace(/^\\s+|\\s+$/g, '')\n    };\n    console.log(updateData);\n    data.forEach((d) => {\n        console.log(d);\n        if (d.id == updateData.id && updateData.declaration_title != 'Title cannot be empty') {\n            d.declaration_title = updateData.declaration_title;\n        }\n    }, updateData);\n\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\n}\n\nconst selectHandler = (e) => {\n    console.log(\"selectHandler\");\n\n    let id = e.target.id.split('_');\n    id = id[id.length - 2];\n    let data = JSON.parse(document.getElementById('id_declarationjson').value);\n    let updateData = {\n        id: id,\n        selected: e.target.checked ? 1 : 0\n    }\n    data.forEach((d) => {\n\n        if (d.id == updateData.id) {\n            d.selected = updateData.selected;\n        }\n    }, updateData);\n\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\n}\nconst deleteDeclarationHandler = (e) => {\n    let id = (e.target.id).split('_');\n    id = id[id.length - 1];\n    let data = JSON.parse(document.getElementById('id_declarationjson').value);\n    let updateData = {\n        id: id,\n        deleted: 1\n    }\n    data.forEach((d) => {\n\n        if (d.id == updateData.id) {\n            d.deleted = updateData.deleted;\n        }\n    }, updateData);\n\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\n}\n\nexport const init = () => {\n    if (!document.getElementById('id_assignsubmission_declaration_enabled').checked) {\n        document.getElementById('add-new-declaration-btn').style.display = 'none';\n    } else {\n        document.getElementById('add-new-declaration-btn').style.display = 'inline-block';\n    }\n\n    document.getElementById('id_assignsubmission_declaration_enabled').addEventListener('change', selectSubmissionHandler);\n    document.querySelector('.add-new-declaration').addEventListener('click', addDeclarationHandler);\n\n    // Textarea add event.\n    document.querySelectorAll('textarea[id^=id_assignsubmission_declaration_]').forEach((textarea) => {\n        textarea.addEventListener('change', changeTextareaHandler);\n    });\n    // Checkbox add event.\n    document.querySelectorAll('input[id^=id_assignsubmission_declaration_]').forEach((checkbox) => {\n\n        let id = checkbox.getAttribute('id').split('_');\n        if (id[id.length - 1] == 'check') {\n            checkbox.addEventListener('change', selectHandler);\n        }\n\n    });\n    // Delete event listeners\n    delete_declaration_1\n    document.querySelectorAll('i[id^=delete_declaration_]').forEach((deleteicon) => {\n        deleteicon.addEventListener('click', deleteDeclarationHandler);\n    })\n\n    makeTitleEditable();\n};"],"names":["addDeclarationHandler","e","console","log","trigger","$","create","type","ModalAddDeclaration","TYPE","selectSubmissionHandler","target","checked","showSubmissionDeclarationElements","hideSubmissionDeclarationElements","match","Array","from","document","querySelectorAll","getElementById","style","display","forEach","el","getAttribute","changeTextareaHandler","id","value","classList","add","remove","split","length","data","JSON","parse","updateData","declaration_text","d","stringify","changeTitleHandler","innerHTML","border","declaration_title","replace","selectHandler","selected","deleteDeclarationHandler","deleted","addEventListener","querySelector","textarea","checkbox","delete_declaration_1","deleteicon","child","index","children","child1","nodeName","setAttribute"],"mappings":"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"}